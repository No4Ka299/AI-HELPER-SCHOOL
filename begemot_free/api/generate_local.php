<?php
// Локальная генерация текста с использованием уникальных шаблонов
header('Content-Type: application/json');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, OPTIONS');
header('Access-Control-Allow-Headers: Content-Type');

// Обработка CORS
if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    exit(0);
}

// Получаем параметры из запроса
$input = json_decode(file_get_contents('php://input'), true);
$topic = isset($input['topic']) ? $input['topic'] : (isset($_POST['topic']) ? $_POST['topic'] : '');
$type = isset($input['type']) ? $input['type'] : (isset($_POST['type']) ? $_POST['type'] : 'referat');

if (empty($topic)) {
    echo json_encode(['error' => 'Тема не указана']);
    exit;
}

// Генерируем уникальный текст на основе темы
function generateUniqueText($topic, $type) {
    // Создаем уникальные шаблоны для разных разделов
    $introductions = [
        "Тема '{$topic}' представляет значительный интерес в современных условиях. В данной работе будет проведен всесторонний анализ данной проблемы, рассмотрены различные аспекты и предложены возможные решения.",
        "Актуальность темы '{$topic}' обусловлена важностью вопроса в контексте современных вызовов. Ниже будет представлено подробное рассмотрение ключевых аспектов темы.",
        "В условиях стремительно развивающегося общества тема '{$topic}' приобретает особую значимость. В настоящей работе будут рассмотрены основные положения и выводы по теме.",
        "Тема '{$topic}' является одной из наиболее обсуждаемых в современной науке. Ниже представлен анализ существующих подходов и новое видение вопроса.",
        "Объективная необходимость изучения темы '{$topic}' определяется важностью понимания фундаментальных аспектов рассматриваемого вопроса."
    ];
    
    $mainParts = [
        "Для более глубокого понимания темы '{$topic}' необходимо рассмотреть следующие аспекты:\n\n1. Теоретические основы и концептуальные подходы\n2. Анализ современных тенденций и трактовок\n3. Практические примеры и приложения\n4. Перспективы дальнейшего развития",
        
        "Основная часть работы посвящена анализу темы '{$topic}'. Рассмотрим ключевые моменты:\n\n- Исторический контекст и развитие\n- Современные интерпретации\n- Проблемы и противоречия\n- Возможные пути решения",
        
        "В рамках основной части будут рассмотрены следующие вопросы, связанные с темой '{$topic}':\n\nI. Теоретические аспекты\nII. Эмпирический анализ\nIII. Прикладные аспекты\nIV. Заключительные выводы",
        
        "Анализ темы '{$topic}' требует рассмотрения нескольких ключевых направлений:\n\n1. Концептуальные основы\n2. Методологические подходы\n3. Практическая реализация\n4. Перспективы развития",
        
        "Основная часть работы посвящена комплексному анализу темы '{$topic}'. Будут рассмотрены:\n\n- Исторические аспекты\n- Современные тенденции\n- Критический анализ\n- Предложения по улучшению"
    ];
    
    $conclusions = [
        "В ходе работы были рассмотрены ключевые аспекты темы '{$topic}'. Были проанализированы различные точки зрения и подходы к решению проблемы. Можно сделать вывод, что тема '{$topic}' имеет важное значение и требует дальнейшего изучения.",
        "Работа позволила всесторонне рассмотреть тему '{$topic}'. Были выявлены важные аспекты и закономерности. Тема '{$topic}' имеет значительный потенциал для дальнейшего развития.",
        "Проведенный анализ темы '{$topic}' показал ее актуальность и значимость. Полученные результаты позволяют сформулировать ряд важных выводов и рекомендаций по дальнейшему изучению.",
        "В заключение можно отметить, что тема '{$topic}' представляет собой сложный и многогранный вопрос, требующий продолжения исследований. Полученные результаты подтверждают важность данной темы.",
        "Обобщая результаты анализа темы '{$topic}', можно сделать вывод о ее высокой значимости в современных условиях. Необходимы дальнейшие исследования для более глубокого понимания."
    ];
    
    $references = [
        "1. Автор, А.А. Название работы по теме '{$topic}' / А.А. Автор. – М.: Издательство, 2024. – 250 с.\n2. Автор, Б.Б. Современные аспекты '{$topic}' / Б.Б. Автор. – СПб.: Издательство, 2024. – 180 с.\n3. Название ресурса [Электронный ресурс]. – Режим доступа: https://example.com (дата обращения: 30.11.2024).",
        "1. Иванов, И.И. Исследование по теме '{$topic}' / И.И. Иванов. – М.: Наука, 2024. – 200 с.\n2. Петров, П.П. Анализ современных тенденций в области '{$topic}' / П.П. Петров. – М.: Академия, 2024. – 150 с.\n3. Электронный ресурс [Электронный ресурс]. – URL: https://example.com (дата обращения: 30.11.2024).",
        "1. Сидоров, С.С. Актуальные вопросы '{$topic}' / С.С. Сидоров. – М.: Просвещение, 2024. – 220 с.\n2. Козлов, К.К. Перспективы развития в области '{$topic}' / К.К. Козлов. – СПб.: Питер, 2024. – 160 с.\n3. Ресурс [Электронный ресурс]. – URL: https://example.com (дата обращения: 30.11.2024)."
    ];
    
    // Выбираем случайные элементы из массивов
    $introduction = $introductions[array_rand($introductions)];
    $mainPart = $mainParts[array_rand($mainParts)];
    $conclusion = $conclusions[array_rand($conclusions)];
    $reference = $references[array_rand($references)];
    
    // Создаем секции для работы
    $sections = [
        ['title' => 'Введение', 'content' => $introduction],
        ['title' => 'Основная часть', 'content' => $mainPart],
        ['title' => 'Заключение', 'content' => $conclusion],
        ['title' => 'Список литературы', 'content' => $reference]
    ];
    
    return [
        'title' => "Работа по теме: {$topic}",
        'introduction' => $introduction,
        'main_part' => $mainPart,
        'conclusion' => $conclusion,
        'references' => $reference,
        'sections' => $sections,
        'success' => true
    ];
}

// Возвращаем результат
$result = generateUniqueText($topic, $type);
echo json_encode($result);
?>